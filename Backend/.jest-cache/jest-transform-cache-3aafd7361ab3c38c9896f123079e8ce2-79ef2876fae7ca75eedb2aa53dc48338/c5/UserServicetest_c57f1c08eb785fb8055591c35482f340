09d8a8135afa568b5c8678ce2db365b6
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const db_1 = require("../../database/db");
const UserModel_1 = require("../../src/model/UserModel");
const UserService_1 = require("../../src/services/UserService");
const a = {
    street: "Street",
    houseNumber: "1",
    postalCode: "12345",
    city: "Berlin",
    country: "Germany",
};
const u = {
    email: "John@doe.com",
    name: {
        first: "John",
        last: "Doe",
    },
    password: "12abcAB!",
    isAdministrator: true,
    address: a,
    birthDate: new Date(),
    gender: "male",
    isActive: true,
    profilePicture: "picture1",
    socialMediaUrls: {
        facebook: "facebook",
        instagram: "instagram",
    },
};
const userService = new UserService_1.UserService();
const NON_EXISTING_ID = "635d2e796ea2e8c9bde5787c";
describe("userModel test", () => {
    beforeAll(async () => await (0, db_1.connect)());
    afterEach(async () => await (0, db_1.clearDatabase)());
    afterAll(async () => await (0, db_1.closeDatabase)());
    test("createUser function", async () => {
        const user = await userService.createUser(u);
        expect(user.id).toBeDefined();
        expect(user.name.first).toBe(u.name.first);
        expect(user.name.last).toBe(u.name.last);
        expect(user.email).toBe(u.email);
        expect(user.password).toBeUndefined();
        const res = await UserModel_1.User.findById(user.id);
        expect(await res.isCorrectPassword("12abcAB!")).toBeTruthy();
        expect(user.address).toMatchObject(a);
        expect(user.birthDate).toBe(u.birthDate);
        expect(user.gender).toBe(u.gender);
        expect(user.isActive).toBeTruthy();
        expect(user.profilePicture).toBe(u.profilePicture);
        expect(user.socialMediaUrls).toMatchObject(u.socialMediaUrls);
    });
    test("getUser works and returns user without password", async () => {
        const user = await userService.createUser(u);
        await expect(userService.getUser(undefined)).rejects.toThrow("Can not get user, userID is invalid");
        await expect(userService.getUser(NON_EXISTING_ID)).rejects.toThrow(`No user with id: ${NON_EXISTING_ID} exists.`);
        const res = await userService.getUser(user.id);
        expect(user.id).toBeDefined();
        expect(user.name.first).toBe(u.name.first);
        expect(user.name.last).toBe(u.name.last);
        expect(user.email).toBe(u.email);
        expect(user.password).toBeUndefined();
        const r = await UserModel_1.User.findById(user.id);
        expect(await r.isCorrectPassword("12abcAB!")).toBeTruthy();
        expect(user.address).toMatchObject(a);
        expect(user.birthDate).toBe(u.birthDate);
        expect(user.gender).toBe(u.gender);
        expect(user.isActive).toBeTruthy();
        expect(user.profilePicture).toBe(u.profilePicture);
        expect(user.socialMediaUrls).toMatchObject(u.socialMediaUrls);
    });
    test("get all users also returns inactive users, getUser(userID) throws error at inactive user.", async () => {
        const u1 = await userService.createUser(u);
        const user1 = {
            id: u1.id,
            email: u1.email,
            name: {
                first: u1.name.first,
                last: u1.name.last,
            },
            isAdministrator: u1.isAdministrator,
            address: u1.address,
            birthDate: u1.birthDate,
            gender: u1.gender,
            isActive: u1.isActive,
        };
        u.isActive = false;
        u.email = "Jane@doe.com";
        u.name.first = "Jane";
        const u2 = await UserModel_1.User.create(u);
        const user2 = {
            id: u2.id,
            email: u2.email,
            name: {
                first: u2.name.first,
                last: u2.name.last,
            },
            isAdministrator: u2.isAdministrator,
            address: u2.address,
            birthDate: u2.birthDate,
            gender: u2.gender,
            isActive: u2.isActive,
        };
        await expect(userService.getUser(u2.id)).rejects.toThrow(`No user with id: ${u2.id} exists.`);
        const users = await userService.getUsers();
        expect(users.users.length).toBe(2);
        expect(users.users[0].isActive).toBe(user1.isActive);
        expect(users.users[1].isActive).toBe(user2.isActive);
    });
    test("updateUserWithAdmin user update validations", async () => {
        const user = await userService.createUser(u);
        const existingUserId = user.id;
        const updatedUser = Object.assign(Object.assign({}, u), { id: existingUserId, email: "newemail@example.com" });
        const result = await userService.updateUserWithAdmin(updatedUser);
        expect(result.id).toBeDefined();
        expect(result.name.first).toBe(updatedUser.name.first);
        expect(result.name.last).toBe(updatedUser.name.last);
        expect(result.email).toBe(updatedUser.email);
        expect(result.password).toBeUndefined();
        expect(result.address).toMatchObject(updatedUser.address);
        expect(result.birthDate).toBe(updatedUser.birthDate);
        expect(result.gender).toBe(updatedUser.gender);
        expect(result.isActive).toBeTruthy();
        expect(result.profilePicture).toBe(updatedUser.profilePicture);
        expect(result.socialMediaUrls).toMatchObject(updatedUser.socialMediaUrls);
        //Test for missing userID
        const userWithNoId = Object.assign(Object.assign({}, u), { id: undefined });
        await expect(userService.updateUserWithAdmin(userWithNoId)).rejects.toThrow("User id is missing, cannot update User.");
        //Test for non-existing userID
        const nonExistingUser = Object.assign(Object.assign({}, u), { id: NON_EXISTING_ID });
        await expect(userService.updateUserWithAdmin(nonExistingUser)).rejects.toThrow(`No user with id: ${NON_EXISTING_ID} found, cannot update`);
    });
    test("updateUserWithAdmin duplicate email check", async () => {
        const user = await userService.createUser(u);
        await userService.createUser(Object.assign(Object.assign({}, u), { email: "duplicate@example.com" }));
        //Create another user with a different ID but same email for duplicate check
        const userWithDuplicateEmail = Object.assign(Object.assign({}, user), { email: "duplicate@example.com" });
        await expect(userService.updateUserWithAdmin(userWithDuplicateEmail)).rejects.toThrow("Duplicate email");
    });
    test("updateUserWithPw update with old password to update password", async () => {
        const oldPw = u.password;
        const user = await userService.createUser(u);
        user.name.first = "Jane";
        user.password = "newPassword123!";
        const updatedUser = await userService.updateUserWithPw(user, oldPw);
        expect(updatedUser.name.first).toBe("Jane");
        const Jane = await UserModel_1.User.findById(user.id).exec();
        expect(Jane.password).toBeDefined();
        expect(await Jane.isCorrectPassword("newPassword123!")).toBeTruthy();
        //Test if user does not update Password on wrong old password.
        await expect(userService.updateUserWithPw(user, "wrongPassword")).rejects.toThrow("invalid oldPassword, can not update User!");
    });
    test("updateUserWithPw throws errors on invalid userdata", async () => {
        const user = await userService.createUser(u);
        user.id = undefined;
        user.name.first = "Jane";
        await expect(userService.updateUserWithPw(user)).rejects.toThrow("User id is missing, cannot update User.");
        user.id = NON_EXISTING_ID;
        await expect(userService.updateUserWithPw(user)).rejects.toThrow(`No user with id: ${NON_EXISTING_ID} found, cannot update`);
    });
    test("updateUserWithPw duplicate email check", async () => {
        const user = await userService.createUser(u);
        await userService.createUser(Object.assign(Object.assign({}, u), { email: "duplicate@example.com" }));
        //Create another user with a different ID but same email for duplicate check
        const userWithDuplicateEmail = Object.assign(Object.assign({}, user), { email: "duplicate@example.com" });
        await expect(userService.updateUserWithPw(userWithDuplicateEmail)).rejects.toThrow("Duplicate email");
    });
    test("updateUserWithPw can not change isActive status of user", async () => {
        const user = await userService.createUser(u);
        user.isActive = false;
        user.name.first = "Jane";
        const res = await userService.updateUserWithPw(user);
        expect(res.isActive).toBeTruthy();
        expect(res.name.first).toBe("Jane");
    });
    test("deleteUser deletes user from database (when performed by an admin)", async () => {
        const user = await userService.createUser(u);
        const res = await userService.deleteUser(user.id, false);
        expect(res).toBeTruthy();
        const noUserFound = await UserModel_1.User.findById(user.id);
        expect(noUserFound).toBeNull();
        await expect(userService.deleteUser(NON_EXISTING_ID, false)).rejects.toThrow("User not found, probably invalid userID or user is already deleted");
        await expect(userService.deleteUser("", false)).rejects.toThrow("invalid userID, can not delete/inactivate account");
    });
    test("deleteUser inactivates acc when inactivateAccount = true", async () => {
        const user = await userService.createUser(u);
        const res = await userService.deleteUser(user.id, true);
        expect(res).toBeTruthy();
        const inactiveUser = await UserModel_1.User.findById(user.id);
        expect(inactiveUser.isActive).toBeFalsy();
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxuYWNldVxcT25lRHJpdmVcXERlc2t0b3BcXFN0dWRpdW1cXDUgU2VtZXN0ZXJcXFByb2pla3RcXGNvbm5lY3RhbmRleHBsb3JlXFxCYWNrZW5kXFx0ZXN0c1xcc2VydmljZXNcXFVzZXJTZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSwwQ0FBMEU7QUFFMUUseURBQWtFO0FBQ2xFLGdFQUE2RDtBQUU3RCxNQUFNLENBQUMsR0FBYTtJQUNsQixNQUFNLEVBQUUsUUFBUTtJQUNoQixXQUFXLEVBQUUsR0FBRztJQUNoQixVQUFVLEVBQUUsT0FBTztJQUNuQixJQUFJLEVBQUUsUUFBUTtJQUNkLE9BQU8sRUFBRSxTQUFTO0NBQ25CLENBQUM7QUFDRixNQUFNLENBQUMsR0FBaUI7SUFDdEIsS0FBSyxFQUFFLGNBQWM7SUFDckIsSUFBSSxFQUFFO1FBQ0osS0FBSyxFQUFFLE1BQU07UUFDYixJQUFJLEVBQUUsS0FBSztLQUNaO0lBQ0QsUUFBUSxFQUFFLFVBQVU7SUFDcEIsZUFBZSxFQUFFLElBQUk7SUFDckIsT0FBTyxFQUFFLENBQUM7SUFDVixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7SUFDckIsTUFBTSxFQUFFLE1BQU07SUFDZCxRQUFRLEVBQUUsSUFBSTtJQUNkLGNBQWMsRUFBRSxVQUFVO0lBQzFCLGVBQWUsRUFBRTtRQUNmLFFBQVEsRUFBRSxVQUFVO1FBQ3BCLFNBQVMsRUFBRSxXQUFXO0tBQ3ZCO0NBQ0YsQ0FBQztBQUVGLE1BQU0sV0FBVyxHQUFnQixJQUFJLHlCQUFXLEVBQUUsQ0FBQztBQUNuRCxNQUFNLGVBQWUsR0FBRywwQkFBMEIsQ0FBQztBQUNuRCxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO0lBQzlCLFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDLE1BQU0sSUFBQSxZQUFPLEdBQUUsQ0FBQyxDQUFDO0lBQ3ZDLFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDLE1BQU0sSUFBQSxrQkFBYSxHQUFFLENBQUMs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QztRQUNqRCxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7UUFFL0IsTUFBTSxNQUFNLENBQ1YsV0FBVyxDQUFDLFVBQVUsQ0FBQyxlQUFlLEVBQUUsS0FBSyxDQUFDLENBQy9DLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FDZixvRUFBb0UsQ0FDckUsQ0FBQztRQUNGLE1BQU0sTUFBTSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FDN0QsbURBQW1ELENBQ3BELENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQywwREFBMEQsRUFBRSxLQUFLLElBQUksRUFBRTtRQUMxRSxNQUFNLElBQUksR0FBRyxNQUFNLFdBQVcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0MsTUFBTSxHQUFHLEdBQUcsTUFBTSxXQUFXLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDeEQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ3pCLE1BQU0sWUFBWSxHQUFHLE1BQU0sZ0JBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2xELE1BQU0sQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDNUMsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXG5hY2V1XFxPbmVEcml2ZVxcRGVza3RvcFxcU3R1ZGl1bVxcNSBTZW1lc3RlclxcUHJvamVrdFxcY29ubmVjdGFuZGV4cGxvcmVcXEJhY2tlbmRcXHRlc3RzXFxzZXJ2aWNlc1xcVXNlclNlcnZpY2UudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjbGVhckRhdGFiYXNlLCBjbG9zZURhdGFiYXNlLCBjb25uZWN0IH0gZnJvbSBcIi4uLy4uL2RhdGFiYXNlL2RiXCI7XHJcbmltcG9ydCB7IHVzZXJSZXNvdXJjZSB9IGZyb20gXCIuLi8uLi9zcmMvUmVzb3VyY2VzXCI7XHJcbmltcG9ydCB7IElBZGRyZXNzLCBJVXNlciwgVXNlciB9IGZyb20gXCIuLi8uLi9zcmMvbW9kZWwvVXNlck1vZGVsXCI7XHJcbmltcG9ydCB7IFVzZXJTZXJ2aWNlIH0gZnJvbSBcIi4uLy4uL3NyYy9zZXJ2aWNlcy9Vc2VyU2VydmljZVwiO1xyXG5cclxuY29uc3QgYTogSUFkZHJlc3MgPSB7XHJcbiAgc3RyZWV0OiBcIlN0cmVldFwiLFxyXG4gIGhvdXNlTnVtYmVyOiBcIjFcIixcclxuICBwb3N0YWxDb2RlOiBcIjEyMzQ1XCIsXHJcbiAgY2l0eTogXCJCZXJsaW5cIixcclxuICBjb3VudHJ5OiBcIkdlcm1hbnlcIixcclxufTtcclxuY29uc3QgdTogdXNlclJlc291cmNlID0ge1xyXG4gIGVtYWlsOiBcIkpvaG5AZG9lLmNvbVwiLFxyXG4gIG5hbWU6IHtcclxuICAgIGZpcnN0OiBcIkpvaG5cIixcclxuICAgIGxhc3Q6IFwiRG9lXCIsXHJcbiAgfSxcclxuICBwYXNzd29yZDogXCIxMmFiY0FCIVwiLFxyXG4gIGlzQWRtaW5pc3RyYXRvcjogdHJ1ZSxcclxuICBhZGRyZXNzOiBhLFxyXG4gIGJpcnRoRGF0ZTogbmV3IERhdGUoKSxcclxuICBnZW5kZXI6IFwibWFsZVwiLFxyXG4gIGlzQWN0aXZlOiB0cnVlLFxyXG4gIHByb2ZpbGVQaWN0dXJlOiBcInBpY3R1cmUxXCIsXHJcbiAgc29jaWFsTWVkaWFVcmxzOiB7XHJcbiAgICBmYWNlYm9vazogXCJmYWNlYm9va1wiLFxyXG4gICAgaW5zdGFncmFtOiBcImluc3RhZ3JhbVwiLFxyXG4gIH0sXHJcbn07XHJcblxyXG5jb25zdCB1c2VyU2VydmljZTogVXNlclNlcnZpY2UgPSBuZXcgVXNlclNlcnZpY2UoKTtcclxuY29uc3QgTk9OX0VYSVNUSU5HX0lEID0gXCI2MzVkMmU3OTZlYTJlOGM5YmRlNTc4N2NcIjtcclxuZGVzY3JpYmUoXCJ1c2VyTW9kZWwgdGVzdFwiLCAoKSA9PiB7XHJcbiAgYmVmb3JlQWxsKGFzeW5jICgpID0+IGF3YWl0IGNvbm5lY3QoKSk7XHJcbiAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IGF3YWl0IGNsZWFyRGF0YWJhc2UoKSk7XHJcbiAgYWZ0ZXJBbGwoYXN5bmMgKCkgPT4gYXdhaXQgY2xvc2VEYXRhYmFzZSgpKTtcclxuXHJcbiAgdGVzdChcImNyZWF0ZVVzZXIgZnVuY3Rpb25cIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHVzZXJTZXJ2aWNlLmNyZWF0ZVVzZXIodSk7XHJcbiAgICBleHBlY3QodXNlci5pZCkudG9CZURlZmluZWQoKTtcclxuICAgIGV4cGVjdCh1c2VyLm5hbWUuZmlyc3QpLnRvQmUodS5uYW1lLmZpcnN0KTtcclxuICAgIGV4cGVjdCh1c2VyLm5hbWUubGFzdCkudG9CZSh1Lm5hbWUubGFzdCk7XHJcbiAgICBleHBlY3QodXNlci5lbWFpbCkudG9CZSh1LmVtYWlsKTtcclxuICAgIGV4cGVjdCh1c2VyLnBhc3N3b3JkKS50b0JlVW5kZWZpbmVkKCk7XHJcbiAgICBjb25zdCByZXMgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHVzZXIuaWQpO1xyXG4gICAgZXhwZWN0KGF3YWl0IHJlcy5pc0NvcnJlY3RQYXNzd29yZChcIjEyYWJjQUIhXCIpKS50b0JlVHJ1dGh5KCk7XHJcbiAgICBleHBlY3QodXNlci5hZGRyZXNzKS50b01hdGNoT2JqZWN0KGEpO1xyXG4gICAgZXhwZWN0KHVzZXIuYmlydGhEYXRlKS50b0JlKHUuYmlydGhEYXRlKTtcclxuICAgIGV4cGVjdCh1c2VyLmdlbmRlcikudG9CZSh1LmdlbmRlcik7XHJcbiAgICBleHBlY3QodXNlci5pc0FjdGl2ZSkudG9CZVRydXRoeSgpO1xyXG4gICAgZXhwZWN0KHVzZXIucHJvZmlsZVBpY3R1cmUpLnRvQmUodS5wcm9maWxlUGljdHVyZSk7XHJcbiAgICBleHBlY3QodXNlci5zb2NpYWxNZWRpYVVybHMpLnRvTWF0Y2hPYmplY3QodS5zb2NpYWxNZWRpYVVybHMpO1xyXG4gIH0pO1xyXG5cclxuICB0ZXN0KFwiZ2V0VXNlciB3b3JrcyBhbmQgcmV0dXJucyB1c2VyIHdpdGhvdXQgcGFzc3dvcmRcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHVzZXJTZXJ2aWNlLmNyZWF0ZVVzZXIodSk7XHJcbiAgICBhd2FpdCBleHBlY3QodXNlclNlcnZpY2UuZ2V0VXNlcih1bmRlZmluZWQpKS5yZWplY3RzLnRvVGhyb3coXHJcbiAgICAgIFwiQ2FuIG5vdCBnZXQgdXNlciwgdXNlcklEIGlzIGludmFsaWRcIixcclxuICAgICk7XHJcbiAgICBhd2FpdCBleHBlY3QodXNlclNlcnZpY2UuZ2V0VXNlcihOT05fRVhJU1RJTkdfSUQpKS5yZWplY3RzLnRvVGhyb3coXHJcbiAgICAgIGBObyB1c2VyIHdpdGggaWQ6ICR7Tk9OX0VYSVNUSU5HX0lEfSBleGlzdHMuYCxcclxuICAgICk7XHJcbiAgICBjb25zdCByZXM6IHVzZXJSZXNvdXJjZSA9IGF3YWl0IHVzZXJTZXJ2aWNlLmdldFVzZXIodXNlci5pZCk7XHJcbiAgICBleHBlY3QodXNlci5pZCkudG9CZURlZmluZWQoKTtcclxuICAgIGV4cGVjdCh1c2VyLm5hbWUuZmlyc3QpLnRvQmUodS5uYW1lLmZpcnN0KTtcclxuICAgIGV4cGVjdCh1c2VyLm5hbWUubGFzdCkudG9CZSh1Lm5hbWUubGFzdCk7XHJcbiAgICBleHBlY3QodXNlci5lbWFpbCkudG9CZSh1LmVtYWlsKTtcclxuICAgIGV4cGVjdCh1c2VyLnBhc3N3b3JkKS50b0JlVW5kZWZpbmVkKCk7XHJcbiAgICBjb25zdCByID0gYXdhaXQgVXNlci5maW5kQnlJZCh1c2VyLmlkKTtcclxuICAgIGV4cGVjdChhd2FpdCByLmlzQ29ycmVjdFBhc3N3b3JkKFwiMTJhYmNBQiFcIikpLnRvQmVUcnV0aHkoKTtcclxuICAgIGV4cGVjdCh1c2VyLmFkZHJlc3MpLnRvTWF0Y2hPYmplY3QoYSk7XHJcbiAgICBleHBlY3QodXNlci5iaXJ0aERhdGUpLnRvQmUodS5iaXJ0aERhdGUpO1xyXG4gICAgZXhwZWN0KHVzZXIuZ2VuZGVyKS50b0JlKHUuZ2VuZGVyKTtcclxuICAgIGV4cGVjdCh1c2VyLmlzQWN0aXZlKS50b0JlVHJ1dGh5KCk7XHJcbiAgICBleHBlY3QodXNlci5wcm9maWxlUGljdHVyZSkudG9CZSh1LnByb2ZpbGVQaWN0dXJlKTtcclxuICAgIGV4cGVjdCh1c2VyLnNvY2lhbE1lZGlhVXJscykudG9NYXRjaE9iamVjdCh1LnNvY2lhbE1lZGlhVXJscyk7XHJcbiAgfSk7XHJcblxyXG4gIHRlc3QoXCJnZXQgYWxsIHVzZXJzIGFsc28gcmV0dXJucyBpbmFjdGl2ZSB1c2VycywgZ2V0VXNlcih1c2VySUQpIHRocm93cyBlcnJvciBhdCBpbmFjdGl2ZSB1c2VyLlwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCB1MSA9IGF3YWl0IHVzZXJTZXJ2aWNlLmNyZWF0ZVVzZXIodSk7XHJcbiAgICBjb25zdCB1c2VyMTogdXNlclJlc291cmNlID0ge1xyXG4gICAgICBpZDogdTEuaWQsXHJcbiAgICAgIGVtYWlsOiB1MS5lbWFpbCxcclxuICAgICAgbmFtZToge1xyXG4gICAgICAgIGZpcnN0OiB1MS5uYW1lLmZpcnN0LFxyXG4gICAgICAgIGxhc3Q6IHUxLm5hbWUubGFzdCxcclxuICAgICAgfSxcclxuICAgICAgaXNBZG1pbmlzdHJhdG9yOiB1MS5pc0FkbWluaXN0cmF0b3IsXHJcbiAgICAgIGFkZHJlc3M6IHUxLmFkZHJlc3MsXHJcbiAgICAgIGJpcnRoRGF0ZTogdTEuYmlydGhEYXRlLFxyXG4gICAgICBnZW5kZXI6IHUxLmdlbmRlcixcclxuICAgICAgaXNBY3RpdmU6IHUxLmlzQWN0aXZlLFxyXG4gICAgfTtcclxuICAgIHUuaXNBY3RpdmUgPSBmYWxzZTtcclxuICAgIHUuZW1haWwgPSBcIkphbmVAZG9lLmNvbVwiO1xyXG4gICAgdS5uYW1lLmZpcnN0ID0gXCJKYW5lXCI7XHJcbiAgICBjb25zdCB1MiA9IGF3YWl0IFVzZXIuY3JlYXRlKHUpO1xyXG4gICAgY29uc3QgdXNlcjI6IHVzZXJSZXNvdXJjZSA9IHtcclxuICAgICAgaWQ6IHUyLmlkLFxyXG4gICAgICBlbWFpbDogdTIuZW1haWwsXHJcbiAgICAgIG5hbWU6IHtcclxuICAgICAgICBmaXJzdDogdTIubmFtZS5maXJzdCxcclxuICAgICAgICBsYXN0OiB1Mi5uYW1lLmxhc3QsXHJcbiAgICAgIH0sXHJcbiAgICAgIGlzQWRtaW5pc3RyYXRvcjogdTIuaXNBZG1pbmlzdHJhdG9yLFxyXG4gICAgICBhZGRyZXNzOiB1Mi5hZGRyZXNzLFxyXG4gICAgICBiaXJ0aERhdGU6IHUyLmJpcnRoRGF0ZSxcclxuICAgICAgZ2VuZGVyOiB1Mi5nZW5kZXIsXHJcbiAgICAgIGlzQWN0aXZlOiB1Mi5pc0FjdGl2ZSxcclxuICAgIH07XHJcbiAgICBhd2FpdCBleHBlY3QodXNlclNlcnZpY2UuZ2V0VXNlcih1Mi5pZCkpLnJlamVjdHMudG9UaHJvdyhcclxuICAgICAgYE5vIHVzZXIgd2l0aCBpZDogJHt1Mi5pZH0gZXhpc3RzLmAsXHJcbiAgICApO1xyXG4gICAgY29uc3QgdXNlcnMgPSBhd2FpdCB1c2VyU2VydmljZS5nZXRVc2VycygpO1xyXG4gICAgZXhwZWN0KHVzZXJzLnVzZXJzLmxlbmd0aCkudG9CZSgyKTtcclxuICAgIGV4cGVjdCh1c2Vycy51c2Vyc1swXS5pc0FjdGl2ZSkudG9CZSh1c2VyMS5pc0FjdGl2ZSk7XHJcbiAgICBleHBlY3QodXNlcnMudXNlcnNbMV0uaXNBY3RpdmUpLnRvQmUodXNlcjIuaXNBY3RpdmUpO1xyXG4gIH0pO1xyXG5cclxuICB0ZXN0KFwidXBkYXRlVXNlcldpdGhBZG1pbiB1c2VyIHVwZGF0ZSB2YWxpZGF0aW9uc1wiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdXNlclNlcnZpY2UuY3JlYXRlVXNlcih1KTtcclxuICAgIGNvbnN0IGV4aXN0aW5nVXNlcklkID0gdXNlci5pZDtcclxuICAgIGNvbnN0IHVwZGF0ZWRVc2VyID0ge1xyXG4gICAgICAuLi51LFxyXG4gICAgICBpZDogZXhpc3RpbmdVc2VySWQsXHJcbiAgICAgIGVtYWlsOiBcIm5ld2VtYWlsQGV4YW1wbGUuY29tXCIsXHJcbiAgICB9O1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlclNlcnZpY2UudXBkYXRlVXNlcldpdGhBZG1pbih1cGRhdGVkVXNlcik7XHJcbiAgICBleHBlY3QocmVzdWx0LmlkKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgZXhwZWN0KHJlc3VsdC5uYW1lLmZpcnN0KS50b0JlKHVwZGF0ZWRVc2VyLm5hbWUuZmlyc3QpO1xyXG4gICAgZXhwZWN0KHJlc3VsdC5uYW1lLmxhc3QpLnRvQmUodXBkYXRlZFVzZXIubmFtZS5sYXN0KTtcclxuICAgIGV4cGVjdChyZXN1bHQuZW1haWwpLnRvQmUodXBkYXRlZFVzZXIuZW1haWwpO1xyXG4gICAgZXhwZWN0KHJlc3VsdC5wYXNzd29yZCkudG9CZVVuZGVmaW5lZCgpO1xyXG4gICAgZXhwZWN0KHJlc3VsdC5hZGRyZXNzKS50b01hdGNoT2JqZWN0KHVwZGF0ZWRVc2VyLmFkZHJlc3MpO1xyXG4gICAgZXhwZWN0KHJlc3VsdC5iaXJ0aERhdGUpLnRvQmUodXBkYXRlZFVzZXIuYmlydGhEYXRlKTtcclxuICAgIGV4cGVjdChyZXN1bHQuZ2VuZGVyKS50b0JlKHVwZGF0ZWRVc2VyLmdlbmRlcik7XHJcbiAgICBleHBlY3QocmVzdWx0LmlzQWN0aXZlKS50b0JlVHJ1dGh5KCk7XHJcbiAgICBleHBlY3QocmVzdWx0LnByb2ZpbGVQaWN0dXJlKS50b0JlKHVwZGF0ZWRVc2VyLnByb2ZpbGVQaWN0dXJlKTtcclxuICAgIGV4cGVjdChyZXN1bHQuc29jaWFsTWVkaWFVcmxzKS50b01hdGNoT2JqZWN0KHVwZGF0ZWRVc2VyLnNvY2lhbE1lZGlhVXJscyk7XHJcblxyXG4gICAgLy9UZXN0IGZvciBtaXNzaW5nIHVzZXJJRFxyXG4gICAgY29uc3QgdXNlcldpdGhOb0lkID0geyAuLi51LCBpZDogdW5kZWZpbmVkIH07XHJcbiAgICBhd2FpdCBleHBlY3QodXNlclNlcnZpY2UudXBkYXRlVXNlcldpdGhBZG1pbih1c2VyV2l0aE5vSWQpKS5yZWplY3RzLnRvVGhyb3coXHJcbiAgICAgIFwiVXNlciBpZCBpcyBtaXNzaW5nLCBjYW5ub3QgdXBkYXRlIFVzZXIuXCIsXHJcbiAgICApO1xyXG5cclxuICAgIC8vVGVzdCBmb3Igbm9uLWV4aXN0aW5nIHVzZXJJRFxyXG4gICAgY29uc3Qgbm9uRXhpc3RpbmdVc2VyID0geyAuLi51LCBpZDogTk9OX0VYSVNUSU5HX0lEIH07XHJcbiAgICBhd2FpdCBleHBlY3QoXHJcbiAgICAgIHVzZXJTZXJ2aWNlLnVwZGF0ZVVzZXJXaXRoQWRtaW4obm9uRXhpc3RpbmdVc2VyKSxcclxuICAgICkucmVqZWN0cy50b1Rocm93KFxyXG4gICAgICBgTm8gdXNlciB3aXRoIGlkOiAke05PTl9FWElTVElOR19JRH0gZm91bmQsIGNhbm5vdCB1cGRhdGVgLFxyXG4gICAgKTtcclxuICB9KTtcclxuXHJcbiAgdGVzdChcInVwZGF0ZVVzZXJXaXRoQWRtaW4gZHVwbGljYXRlIGVtYWlsIGNoZWNrXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB1c2VyU2VydmljZS5jcmVhdGVVc2VyKHUpO1xyXG4gICAgYXdhaXQgdXNlclNlcnZpY2UuY3JlYXRlVXNlcih7IC4uLnUsIGVtYWlsOiBcImR1cGxpY2F0ZUBleGFtcGxlLmNvbVwiIH0pO1xyXG4gICAgLy9DcmVhdGUgYW5vdGhlciB1c2VyIHdpdGggYSBkaWZmZXJlbnQgSUQgYnV0IHNhbWUgZW1haWwgZm9yIGR1cGxpY2F0ZSBjaGVja1xyXG4gICAgY29uc3QgdXNlcldpdGhEdXBsaWNhdGVFbWFpbCA9IHsgLi4udXNlciwgZW1haWw6IFwiZHVwbGljYXRlQGV4YW1wbGUuY29tXCIgfTtcclxuICAgIGF3YWl0IGV4cGVjdChcclxuICAgICAgdXNlclNlcnZpY2UudXBkYXRlVXNlcldpdGhBZG1pbih1c2VyV2l0aER1cGxpY2F0ZUVtYWlsKSxcclxuICAgICkucmVqZWN0cy50b1Rocm93KFwiRHVwbGljYXRlIGVtYWlsXCIpO1xyXG4gIH0pO1xyXG5cclxuICB0ZXN0KFwidXBkYXRlVXNlcldpdGhQdyB1cGRhdGUgd2l0aCBvbGQgcGFzc3dvcmQgdG8gdXBkYXRlIHBhc3N3b3JkXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IG9sZFB3OiBzdHJpbmcgPSB1LnBhc3N3b3JkO1xyXG4gICAgY29uc3QgdXNlcjogdXNlclJlc291cmNlID0gYXdhaXQgdXNlclNlcnZpY2UuY3JlYXRlVXNlcih1KTtcclxuXHJcbiAgICB1c2VyLm5hbWUuZmlyc3QgPSBcIkphbmVcIjtcclxuICAgIHVzZXIucGFzc3dvcmQgPSBcIm5ld1Bhc3N3b3JkMTIzIVwiO1xyXG4gICAgY29uc3QgdXBkYXRlZFVzZXI6IHVzZXJSZXNvdXJjZSA9IGF3YWl0IHVzZXJTZXJ2aWNlLnVwZGF0ZVVzZXJXaXRoUHcoXHJcbiAgICAgIHVzZXIsXHJcbiAgICAgIG9sZFB3LFxyXG4gICAgKTtcclxuICAgIGV4cGVjdCh1cGRhdGVkVXNlci5uYW1lLmZpcnN0KS50b0JlKFwiSmFuZVwiKTtcclxuICAgIGNvbnN0IEphbmUgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHVzZXIuaWQpLmV4ZWMoKTtcclxuICAgIGV4cGVjdChKYW5lLnBhc3N3b3JkKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgZXhwZWN0KGF3YWl0IEphbmUuaXNDb3JyZWN0UGFzc3dvcmQoXCJuZXdQYXNzd29yZDEyMyFcIikpLnRvQmVUcnV0aHkoKTtcclxuXHJcbiAgICAvL1Rlc3QgaWYgdXNlciBkb2VzIG5vdCB1cGRhdGUgUGFzc3dvcmQgb24gd3Jvbmcgb2xkIHBhc3N3b3JkLlxyXG4gICAgYXdhaXQgZXhwZWN0KFxyXG4gICAgICB1c2VyU2VydmljZS51cGRhdGVVc2VyV2l0aFB3KHVzZXIsIFwid3JvbmdQYXNzd29yZFwiKSxcclxuICAgICkucmVqZWN0cy50b1Rocm93KFwiaW52YWxpZCBvbGRQYXNzd29yZCwgY2FuIG5vdCB1cGRhdGUgVXNlciFcIik7XHJcbiAgfSk7XHJcblxyXG4gIHRlc3QoXCJ1cGRhdGVVc2VyV2l0aFB3IHRocm93cyBlcnJvcnMgb24gaW52YWxpZCB1c2VyZGF0YVwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCB1c2VyOiB1c2VyUmVzb3VyY2UgPSBhd2FpdCB1c2VyU2VydmljZS5jcmVhdGVVc2VyKHUpO1xyXG4gICAgdXNlci5pZCA9IHVuZGVmaW5lZDtcclxuICAgIHVzZXIubmFtZS5maXJzdCA9IFwiSmFuZVwiO1xyXG4gICAgYXdhaXQgZXhwZWN0KHVzZXJTZXJ2aWNlLnVwZGF0ZVVzZXJXaXRoUHcodXNlcikpLnJlamVjdHMudG9UaHJvdyhcclxuICAgICAgXCJVc2VyIGlkIGlzIG1pc3NpbmcsIGNhbm5vdCB1cGRhdGUgVXNlci5cIixcclxuICAgICk7XHJcbiAgICB1c2VyLmlkID0gTk9OX0VYSVNUSU5HX0lEO1xyXG4gICAgYXdhaXQgZXhwZWN0KHVzZXJTZXJ2aWNlLnVwZGF0ZVVzZXJXaXRoUHcodXNlcikpLnJlamVjdHMudG9UaHJvdyhcclxuICAgICAgYE5vIHVzZXIgd2l0aCBpZDogJHtOT05fRVhJU1RJTkdfSUR9IGZvdW5kLCBjYW5ub3QgdXBkYXRlYCxcclxuICAgICk7XHJcbiAgfSk7XHJcblxyXG4gIHRlc3QoXCJ1cGRhdGVVc2VyV2l0aFB3IGR1cGxpY2F0ZSBlbWFpbCBjaGVja1wiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdXNlclNlcnZpY2UuY3JlYXRlVXNlcih1KTtcclxuICAgIGF3YWl0IHVzZXJTZXJ2aWNlLmNyZWF0ZVVzZXIoeyAuLi51LCBlbWFpbDogXCJkdXBsaWNhdGVAZXhhbXBsZS5jb21cIiB9KTtcclxuICAgIC8vQ3JlYXRlIGFub3RoZXIgdXNlciB3aXRoIGEgZGlmZmVyZW50IElEIGJ1dCBzYW1lIGVtYWlsIGZvciBkdXBsaWNhdGUgY2hlY2tcclxuICAgIGNvbnN0IHVzZXJXaXRoRHVwbGljYXRlRW1haWwgPSB7IC4uLnVzZXIsIGVtYWlsOiBcImR1cGxpY2F0ZUBleGFtcGxlLmNvbVwiIH07XHJcbiAgICBhd2FpdCBleHBlY3QoXHJcbiAgICAgIHVzZXJTZXJ2aWNlLnVwZGF0ZVVzZXJXaXRoUHcodXNlcldpdGhEdXBsaWNhdGVFbWFpbCksXHJcbiAgICApLnJlamVjdHMudG9UaHJvdyhcIkR1cGxpY2F0ZSBlbWFpbFwiKTtcclxuICB9KTtcclxuXHJcbiAgdGVzdChcInVwZGF0ZVVzZXJXaXRoUHcgY2FuIG5vdCBjaGFuZ2UgaXNBY3RpdmUgc3RhdHVzIG9mIHVzZXJcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHVzZXJTZXJ2aWNlLmNyZWF0ZVVzZXIodSk7XHJcbiAgICB1c2VyLmlzQWN0aXZlID0gZmFsc2U7XHJcbiAgICB1c2VyLm5hbWUuZmlyc3QgPSBcIkphbmVcIjtcclxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHVzZXJTZXJ2aWNlLnVwZGF0ZVVzZXJXaXRoUHcodXNlcik7XHJcbiAgICBleHBlY3QocmVzLmlzQWN0aXZlKS50b0JlVHJ1dGh5KCk7XHJcbiAgICBleHBlY3QocmVzLm5hbWUuZmlyc3QpLnRvQmUoXCJKYW5lXCIpO1xyXG4gIH0pO1xyXG5cclxuICB0ZXN0KFwiZGVsZXRlVXNlciBkZWxldGVzIHVzZXIgZnJvbSBkYXRhYmFzZSAod2hlbiBwZXJmb3JtZWQgYnkgYW4gYWRtaW4pXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB1c2VyU2VydmljZS5jcmVhdGVVc2VyKHUpO1xyXG4gICAgY29uc3QgcmVzID0gYXdhaXQgdXNlclNlcnZpY2UuZGVsZXRlVXNlcih1c2VyLmlkLCBmYWxzZSk7XHJcbiAgICBleHBlY3QocmVzKS50b0JlVHJ1dGh5KCk7XHJcbiAgICBjb25zdCBub1VzZXJGb3VuZCA9IGF3YWl0IFVzZXIuZmluZEJ5SWQodXNlci5pZCk7XHJcbiAgICBleHBlY3Qobm9Vc2VyRm91bmQpLnRvQmVOdWxsKCk7XHJcblxyXG4gICAgYXdhaXQgZXhwZWN0KFxyXG4gICAgICB1c2VyU2VydmljZS5kZWxldGVVc2VyKE5PTl9FWElTVElOR19JRCwgZmFsc2UpLFxyXG4gICAgKS5yZWplY3RzLnRvVGhyb3coXHJcbiAgICAgIFwiVXNlciBub3QgZm91bmQsIHByb2JhYmx5IGludmFsaWQgdXNlcklEIG9yIHVzZXIgaXMgYWxyZWFkeSBkZWxldGVkXCIsXHJcbiAgICApO1xyXG4gICAgYXdhaXQgZXhwZWN0KHVzZXJTZXJ2aWNlLmRlbGV0ZVVzZXIoXCJcIiwgZmFsc2UpKS5yZWplY3RzLnRvVGhyb3coXHJcbiAgICAgIFwiaW52YWxpZCB1c2VySUQsIGNhbiBub3QgZGVsZXRlL2luYWN0aXZhdGUgYWNjb3VudFwiLFxyXG4gICAgKTtcclxuICB9KTtcclxuXHJcbiAgdGVzdChcImRlbGV0ZVVzZXIgaW5hY3RpdmF0ZXMgYWNjIHdoZW4gaW5hY3RpdmF0ZUFjY291bnQgPSB0cnVlXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB1c2VyU2VydmljZS5jcmVhdGVVc2VyKHUpO1xyXG4gICAgY29uc3QgcmVzID0gYXdhaXQgdXNlclNlcnZpY2UuZGVsZXRlVXNlcih1c2VyLmlkLCB0cnVlKTtcclxuICAgIGV4cGVjdChyZXMpLnRvQmVUcnV0aHkoKTtcclxuICAgIGNvbnN0IGluYWN0aXZlVXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQodXNlci5pZCk7XHJcbiAgICBleHBlY3QoaW5hY3RpdmVVc2VyLmlzQWN0aXZlKS50b0JlRmFsc3koKTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==